#lua.conf 
#测试时使用的动态请求  
map $host $item_dynamic {  
    default                    "0";  
    192.168.1.157              "1";  
}   
server {  
    listen       80;  
    server_name  _;
    set $basepath '/usr/example';
    resolver 114.114.114.114;
    location /lua{
        default_type 'text/html';
	#每次请求丢初始化lua vm所以共享内存无效
	#lua_code_cache off;
	content_by_lua_file $basepath/lua/test.lua;
    }
    location ~ /lua_request/(\d+)/(\d+)/(\d+){
	set $a $1;
	set $b $host;
	default_type 'text/html';
        content_by_lua_file $basepath/lua/test_request.lua;
    }
    location /lua_response_1 {  
        default_type "text/html";  
        content_by_lua_file $basepath/lua/test_response_1.lua;  
    }  
    location /lua_response_2 {  
        default_type "text/html";  
        content_by_lua_file $basepath/lua/test_response_2.lua;  
    }  
    location /lua_other {  
        default_type "text/html";  
        content_by_lua_file $basepath/lua/test_other.lua;  
    }  
    location /lua_shared_dict {  
        default_type "text/html";  
        content_by_lua_file $basepath/lua/test_shared_dict.lua;  
    }  
    location /test_set_1 {  
        default_type "text/html";  
        set_by_lua_file $num  $basepath/lua/test_set_1.lua; 
	echo $num; 
    }
    location /test_set_2 {  
        default_type "text/html";
	set $uri_var http://www.jd.com/;
	if ($item_dynamic = "1") {  
   	    set $uri_var http://www.taobao.com/;  
	}
	proxy_pass $uri_var; 
    }
    location /lua_rewrite_1 {  
        default_type "text/html";  
        rewrite_by_lua_file $basepath/lua/test_rewrite_1.lua;  
        echo "no rewrite";  
    }  
    location /lua_rewrite_2 {  
        default_type "text/html";  
        rewrite_by_lua_file $basepath/lua/test_rewrite_2.lua;  
        echo "rewrite2 uri : $uri,a : $arg_a";
    }  
    location /lua_rewrite_3 {  
        default_type "text/html";  
        rewrite_by_lua_file $basepath/lua/test_rewrite_3.lua;  
        echo "rewrite3 uri : $uri";  
    } 
    location /lua_access {  
        default_type "text/html";  
        access_by_lua_file $basepath/lua/test_access.lua;  
        echo "access";  
    } 
    location /filename {  
        default_type "text/html";  
        echo $request_filename;  
    } 
    location /c_lua {  
        default_type "text/html";  
        set_by_lua_file $result $basepath/lua/test_lua_c_1.lua; 
	echo $result; 
    }  
}  
